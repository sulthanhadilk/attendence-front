import{r as d,a as x,A as h,j as e,m}from"./index-Dt65c9OV.js";const $=({userRole:c})=>{const[j,v]=d.useState([]),[p,u]=d.useState(!1),[o,g]=d.useState(""),[N,f]=d.useState([]),[l,y]=d.useState("student"),[n,S]=d.useState(null);d.useEffect(()=>{(c==="admin"||c==="teacher")&&R(),c==="admin"&&A()},[c]);const R=async()=>{try{const s=await x(h.STUDENTS);f(s)}catch(s){console.error("Error fetching students:",s)}},A=async()=>{try{const s=await x(`${h.AI_BASE}/admin-insights`);S(s)}catch(s){console.error("Error fetching admin insights:",s)}},k=async()=>{if(l==="student"&&!o){alert("Please select a student");return}u(!0);try{const s=l==="student"?`${h.AI_BASE}/generate-report/${o}`:`${h.AI_BASE}/admin-insights`,a=await x(s);l==="student"&&v(t=>{var i;return[{id:Date.now(),type:"student",studentName:(i=N.find(r=>r._id===o))==null?void 0:i.name,data:a,timestamp:new Date},...t]})}catch(s){console.error("Error generating report:",s),alert("Error generating report. Please try again.")}finally{u(!1)}},w=s=>{const a=E(s),t=new Blob([a],{type:"text/plain"}),i=URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download=`${s.type}_report_${s.studentName||"admin"}_${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)},E=s=>{let a=`AI-POWERED ACADEMIC REPORT
=====================================
Report Type: ${s.type==="student"?"Student Performance":"Administrative Insights"}
Generated: ${s.timestamp.toLocaleString()}
`;return s.type==="student"&&(a+=`
Student: ${s.studentName}
AI SUMMARY
----------
${s.data.aiSummary}
PERFORMANCE METRICS
------------------
Overall Grade: ${s.data.overallGrade}
Attendance Rate: ${Math.round(s.data.attendanceRate*100)}%
Risk Level: ${s.data.riskLevel}
SUBJECT BREAKDOWN
----------------
`,s.data.subjectPerformance.forEach(t=>{a+=`${t.name}: ${t.grade} (${t.average}% avg, ${Math.round(t.attendance*100)}% attendance)
`}),a+=`
RECOMMENDATIONS
--------------
`,s.data.recommendations.forEach((t,i)=>{a+=`${i+1}. ${t}
`})),a};return e.jsxs("div",{className:"ai-report-generator",children:[e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"generator-header",children:[e.jsxs("h2",{children:[e.jsx("i",{className:"fas fa-file-alt mr-2"}),"AI Report Generator"]}),e.jsx("p",{children:"Generate comprehensive AI-powered academic reports"})]}),e.jsxs(m.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},className:"report-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{children:"Report Type:"}),e.jsxs("select",{value:l,onChange:s=>y(s.target.value),className:"form-select",children:[e.jsx("option",{value:"student",children:"Student Performance Report"}),c==="admin"&&e.jsx("option",{value:"admin",children:"Administrative Insights"})]})]}),l==="student"&&e.jsxs("div",{className:"control-group",children:[e.jsx("label",{children:"Select Student:"}),e.jsxs("select",{value:o,onChange:s=>g(s.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a student..."}),N.map(s=>e.jsxs("option",{value:s._id,children:[s.name," - ",s.rollNumber]},s._id))]})]}),e.jsx("button",{onClick:k,disabled:p||l==="student"&&!o,className:"generate-btn",children:p?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-magic mr-2"}),"Generate AI Report"]})})]}),c==="admin"&&n&&e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"admin-insights-section",children:[e.jsxs("h3",{children:[e.jsx("i",{className:"fas fa-chart-pie mr-2"}),"Administrative Insights"]}),e.jsxs("div",{className:"insights-grid",children:[e.jsxs("div",{className:"insight-card",children:[e.jsxs("div",{className:"insight-header",children:[e.jsx("i",{className:"fas fa-users"}),e.jsx("h4",{children:"Student Overview"})]}),e.jsxs("div",{className:"insight-content",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Total Students:"}),e.jsx("span",{className:"stat-value",children:n.totalStudents})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"At Risk Students:"}),e.jsx("span",{className:"stat-value text-danger",children:n.atRiskStudents})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Average Attendance:"}),e.jsxs("span",{className:"stat-value",children:[Math.round(n.averageAttendance*100),"%"]})]})]})]}),e.jsxs("div",{className:"insight-card",children:[e.jsxs("div",{className:"insight-header",children:[e.jsx("i",{className:"fas fa-exclamation-triangle"}),e.jsx("h4",{children:"Risk Analysis"})]}),e.jsx("div",{className:"insight-content",children:e.jsxs("div",{className:"risk-breakdown",children:[e.jsxs("div",{className:"risk-item high-risk",children:[e.jsx("span",{children:"High Risk:"}),e.jsx("span",{children:n.riskBreakdown.high})]}),e.jsxs("div",{className:"risk-item medium-risk",children:[e.jsx("span",{children:"Medium Risk:"}),e.jsx("span",{children:n.riskBreakdown.medium})]}),e.jsxs("div",{className:"risk-item low-risk",children:[e.jsx("span",{children:"Low Risk:"}),e.jsx("span",{children:n.riskBreakdown.low})]})]})})]}),e.jsxs("div",{className:"insight-card full-width",children:[e.jsxs("div",{className:"insight-header",children:[e.jsx("i",{className:"fas fa-lightbulb"}),e.jsx("h4",{children:"AI Recommendations"})]}),e.jsx("div",{className:"insight-content",children:e.jsx("ul",{className:"recommendations-list",children:n.recommendations.map((s,a)=>e.jsxs("li",{className:"recommendation-item",children:[e.jsx("i",{className:"fas fa-arrow-right mr-2"}),s]},a))})})]})]})]}),j.length>0&&e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"generated-reports",children:[e.jsxs("h3",{children:[e.jsx("i",{className:"fas fa-history mr-2"}),"Generated Reports"]}),e.jsx("div",{className:"reports-list",children:j.map(s=>e.jsxs(m.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"report-item",children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{className:"report-info",children:[e.jsxs("h4",{children:[s.studentName," - Performance Report"]}),e.jsxs("p",{children:["Generated: ",s.timestamp.toLocaleString()]})]}),e.jsxs("button",{onClick:()=>w(s),className:"download-btn",children:[e.jsx("i",{className:"fas fa-download mr-2"}),"Download"]})]}),e.jsxs("div",{className:"report-preview",children:[e.jsxs("div",{className:"ai-summary",children:[e.jsx("h5",{children:"AI Summary:"}),e.jsx("p",{children:s.data.aiSummary})]}),e.jsxs("div",{className:"key-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("span",{children:"Overall Grade:"}),e.jsx("span",{className:`grade-badge grade-${s.data.overallGrade.toLowerCase()}`,children:s.data.overallGrade})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{children:"Attendance:"}),e.jsxs("span",{children:[Math.round(s.data.attendanceRate*100),"%"]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{children:"Risk Level:"}),e.jsx("span",{className:`risk-badge risk-${s.data.riskLevel.toLowerCase()}`,children:s.data.riskLevel})]})]})]})]},s.id))})]})]})};export{$ as default};
